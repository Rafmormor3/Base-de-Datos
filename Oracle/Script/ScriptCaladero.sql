DROP TABLE BARCOS CASCADE CONSTRAINT; 
DROP TABLE CALADERO CASCADE CONSTRAINT; 
DROP TABLE ESPECIE CASCADE CONSTRAINT;
DROP TABLE FECHAS_CAPTURAS_PERMITIDAS CASCADE CONSTRAINT;
DROP TABLE LOTES CASCADE CONSTRAINT;

CREATE TABLE BARCOS
(
	MATRICULA VARCHAR2(20),
	NOMBRE VARCHAR2(20),
	CLASE VARCHAR2(20),
	ARMADOR VARCHAR2(20),
	CAPACIDAD NUMBER(10),
	NACIONALIDAD VARCHAR2(20),
	
	CONSTRAINT PK_BARCOS PRIMARY KEY (MATRICULA)
);

CREATE TABLE LOTES 
(
	CODIGO VARCHAR2(20),
	MATRICULA VARCHAR2(20) NOT NULL,
	NUMKILOS NUMBER(5,2),
	PRECIOPORKILOSALIDA NUMBER(5,2),
	PRECIOPORKILOADJUDICADO NUMBER(5,2),
	FECHAVENTA DATE NOT NULL,
	COD_ESPECIE VARCHAR2(20),
	
	CONSTRAINT PK_LOTES PRIMARY KEY (CODIGO),
	CONSTRAINT FK1_LOTES FOREIGN KEY (MATRICULA) REFERENCES BARCOS(MATRICULA) ON DELETE CASCADE

);

CREATE TABLE ESPECIE
(
	CODIGO VARCHAR2(20),
	NOMBRE VARCHAR2(20),
	TIPO VARCHAR2(20),
	CUPOPORBARCO NUMBER(10),
	CALADERO_PRINCIPAL VARCHAR2(20),
	
	CONSTRAINT PK_ESPECIE PRIMARY KEY (CODIGO)
);

CREATE TABLE CALADERO
(
	CODIGO VARCHAR2(20),
	NOMBRE VARCHAR2(20),
	UBICACION VARCHAR2(20),
	ESPECIE_PRINCIPAL VARCHAR2(20),
	
	CONSTRAINT PK_CALADERO PRIMARY KEY (CODIGO),
	CONSTRAINT FK1_CALADERO FOREIGN KEY (ESPECIE_PRINCIPAL) REFERENCES ESPECIE(CODIGO) ON DELETE SET NULL 
);

CREATE TABLE FECHAS_CAPTURAS_PERMITIDAS
(
	COD_ESPECIE VARCHAR2(20),
	COD_CALADERO VARCHAR2(20),
	FECHA_INICIAL DATE,
	FECHA_FINAL DATE,
	
	CONSTRAINT PK_FECHAS_CAPTURAS_PERMITIDAS PRIMARY KEY (COD_ESPECIE, COD_CALADERO),
	CONSTRAINT FK1_FECHAS_CAPTURAS_PERMITIDAS FOREIGN KEY (COD_ESPECIE) REFERENCES ESPECIE(CODIGO),
	CONSTRAINT FK2_FECHAS_CAPTURAS_PERMITIDAS FOREIGN KEY (COD_CALADERO) REFERENCES CALADERO(CODIGO)
);


ALTER TABLE LOTES ADD CONSTRAINT FK2_LOTES FOREIGN KEY (COD_ESPECIE) REFERENCES ESPECIE(CODIGO);
ALTER TABLE ESPECIE ADD CONSTRAINT FK1_ESPECIE FOREIGN KEY (CALADERO_PRINCIPAL) REFERENCES CALADERO(CODIGO);

ALTER TABLE BARCOS ADD CONSTRAINT CH1_MATRICULA CHECK (REGEXP_LIKE(MATRICULA, '^[A-Z]{2}-[0-9]{4}'));
ALTER TABLE LOTES ADD CONSTRAINT CH2_PRECIOPORKILOADJUDICADOS CHECK (PRECIOPORKILOADJUDICADO>PRECIOPORKILOSALIDA);
ALTER TABLE LOTES ADD CONSTRAINT CH2_PRECIOS CHECK (NUMKILOS>0 AND PRECIOPORKILOSALIDA>0 AND PRECIOPORKILOADJUDICADO>0);
ALTER TABLE CALADERO ADD CONSTRAINT CH3_MAYUSCULAS CHECK (UPPER(NOMBRE)=NOMBRE AND UPPER(UBICACION)=UBICACION);
ALTER TABLE FECHAS_CAPTURAS_PERMITIDAS ADD CONSTRAINT CH4_INICIAL CHECK (TO_CHAR(FECHA_INICIAL, 'MM/DD')<'02/02' OR TO_CHAR(FECHA_INICIAL, 'MM/DD')>'03/28') ;
ALTER TABLE FECHAS_CAPTURAS_PERMITIDAS ADD CONSTRAINT CH5_FINAL CHECK (TO_CHAR(FECHA_FINAL, 'MM/DD')<'02/02' OR TO_CHAR(FECHA_FINAL, 'MM/DD')>'03/28') ;

ALTER TABLE CALADERO ADD NOMBRE_CIENTIFICO VARCHAR2(20);

ALTER TABLE LOTES DISABLE CONSTRAINT FK2_LOTES;
ALTER TABLE ESPECIE DISABLE CONSTRAINT FK1_ESPECIE;

INSERT INTO BARCOS VALUES ('AA-3456','ANTONIO','YATE','ANTONIO','400','ESPANIA');
INSERT INTO BARCOS VALUES ('AZ-3896','ROMPEOLAS','PESQUERO','YEREMI','800','ARGENTINO');
INSERT INTO LOTES (CODIGO,MATRICULA,NUMKILOS,PRECIOPORKILOSALIDA,PRECIOPORKILOADJUDICADO,FECHAVENTA,COD_ESPECIE) VALUES ('SP890','AA-3456','50','70','150',TO_DATE('12/12/2005','DD/MM/YY'),'345A');
INSERT INTO LOTES (CODIGO,MATRICULA,NUMKILOS,PRECIOPORKILOSALIDA,PRECIOPORKILOADJUDICADO,FECHAVENTA,COD_ESPECIE) VALUES ('GHT67','AZ-3896','40','50','80',TO_DATE('22/05/2010','DD/MM/YY'),'456T');
INSERT INTO ESPECIE (CODIGO,NOMBRE,TIPO,CUPOPORBARCO,CALADERO_PRINCIPAL) VALUES ('345A','ATUN','ROJO','30','ESTE');
INSERT INTO ESPECIE (CODIGO,NOMBRE,TIPO,CUPOPORBARCO,CALADERO_PRINCIPAL) VALUES ('456T','PEZ ESPADA','AZUL','25','OESTE');
INSERT INTO CALADERO (CODIGO,NOMBRE,UBICACION,ESPECIE_PRINCIPAL) VALUES ('ESTE','SIRENA','VALENCIA','345A');
INSERT INTO CALADERO (CODIGO,NOMBRE,UBICACION,ESPECIE_PRINCIPAL) VALUES ('OESTE','NEPTUNO','CADIZ','456T');
INSERT INTO FECHAS_CAPTURAS_PERMITIDAS (COD_ESPECIE,COD_CALADERO,FECHA_INICIAL,FECHA_FINAL) VALUES ('345A','ESTE',NULL,NULL);
INSERT INTO FECHAS_CAPTURAS_PERMITIDAS (COD_ESPECIE,COD_CALADERO,FECHA_INICIAL,FECHA_FINAL) VALUES ('456T','OESTE',NULL,NULL);

ALTER TABLE LOTES ENABLE CONSTRAINT FK2_LOTES;
ALTER TABLE ESPECIE ENABLE CONSTRAINT FK1_ESPECIE;

ALTER TABLE BARCOS DROP COLUMN ARMADOR;


